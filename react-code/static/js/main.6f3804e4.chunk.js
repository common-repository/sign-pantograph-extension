(this["webpackJsonpdlot-client"]=this["webpackJsonpdlot-client"]||[]).push([[1],{13:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return u}));var r={METAMASK:"METAMASK",USER_AUTHENTICATION:"USER_AUTHENTICATION"},a={LOADING:"loading",NOWEB3:"noweb3",ERROR:"error",LOCKED:"locked",CHANGEACCOUNT:"changeaccount",READY:"ready"},u=[{key:88,type:"Mainnet"},{key:89,type:"Testnet"}]},20:function(t,e,n){"use strict";var r={};n.r(r),n.d(r,"metamask",(function(){return l})),n.d(r,"userAuth",(function(){return p}));var a=n(45),u=n(229),c=n(133),o=n(67),i=n(51),s=n(69),f=n(70),l=Object(f.b)(s.a.metamask,Object(o.a)({},i.a.SET_METAMASK,(function(t,e){return e.payload}))),p=Object(f.b)(s.a.userAuth,Object(o.a)({},i.a.SET_USER_AUTHENTICATION,(function(t,e){return e.payload}))),d=n(559),h=Object(a.c)(Object(c.a)({},r,{form:d.a}));n(332);n.d(e,"a",(function(){return v}));var m=[u.a];var v=Object(a.d)(h,a.a.apply(void 0,m))},225:function(t,e){t.exports={translations:{"metamask.pleaseInstallFirst":"Please install MetaMask first!","metamask.youNeedSignMessage":"You need to sign the message to be able to use system!","metamask.youHaveBeenBlocked":"System has detected that you have withdrawn money from smartcontract. \n    Therefore, for security reason, your account has been locked. Please contact us if you have any questions.","metamask.onlySupportNetwork":"Tomorrowsprice only supports {{network}} network in Ethereum blockchain. Please check your network."}}},226:function(t,e){t.exports={translations:{}}},227:function(t,e){t.exports={translations:{}}},228:function(t,e){t.exports={translations:{}}},23:function(t,e,n){"use strict";n.d(e,"b",(function(){return p})),n.d(e,"a",(function(){return d}));var r=n(1),a=n.n(r),u=n(8),c=n(29),o=n(30),i=n(49),s=n(138),f=n(149),l=n(334),p=f.tomoWeb3||f.web3,d=function(){function t(){Object(c.a)(this,t)}return Object(o.a)(t,null,[{key:"web3Read",value:function(){var t=Object(u.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getNetwork();case 2:return e=t.sent,t.abrupt("return",new l(new l.providers.HttpProvider(89==e?"https://rpc.testnet.tomochain.com":"https://rpc.tomochain.com")));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onSignMessage",value:function(){var t=Object(u.a)(a.a.mark((function t(e,n){var r,u;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Promise((function(t,r){try{p.personal.sign(p.fromUtf8(n),e,(function(n,r){return t(n||{address:e,signature:r})}))}catch(a){return r(a)}})),u=new Promise((function(t,e){setTimeout((function(){return e("Request timeout")}),3e4)})),t.abrupt("return",Promise.race([r,u]));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"enableMetaMask",value:function(){var t=Object(u.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(u.a)(a.a.mark((function t(e,n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.currentProvider.enable().then((function(t){e(t)})).catch((function(t){n(t)}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"estimateGas",value:function(){var t=Object(u.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(u.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.eth.estimateGas(e,(function(t,e){t?r(t):n(e)}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getNetwork",value:function(){var t=Object(u.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(u.a)(a.a.mark((function t(e,n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.version.getNetwork((function(t,r){t?n(t):e(r)}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getNonce",value:function(){var t=Object(u.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(u.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.eth.getTransactionCount(e,(function(t,e){t&&n(0),n(e)}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getTomoBalance",value:function(){var t=Object(u.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=Object(u.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new l(p.currentProvider).eth.getBalance(e,(function(t,e){t&&n(0),console.log("---balance---",e),n(e>0?Object(i.a)(e):0)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),t}();d.isString=function(t){return t&&"string"===typeof t},d.isValidAddressFormat=function(t){return t&&d.isString(t)&&t.startsWith("0x")&&42===t.length},d.convertWeiToBalance=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:18,n=new s.BigDecimal(Math.pow(10,e)),r=new s.BigDecimal(String(t));return r.divide(n).toString()}},239:function(t,e,n){t.exports=n(557)},333:function(t,e,n){},346:function(t,e){},35:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return o}));var r=n(51),a=n(13),u=n(49);function c(t){return{type:r.a.SET_METAMASK,payload:t}}function o(t){return Object(u.c)(a.a.USER_AUTHENTICATION,t),{type:r.a.SET_USER_AUTHENTICATION,payload:t}}},371:function(t,e){},373:function(t,e){},447:function(t,e){},49:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return c}));n(98);var r=n(138),a=function(t,e){localStorage.setItem(t,JSON.stringify(e))},u=function(t){return JSON.parse(localStorage.getItem(t))},c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:18,n=new r.BigDecimal(Math.pow(10,e)),a=new r.BigDecimal(String(t));return a.divide(n).toString()}},51:function(t,e,n){"use strict";var r=n(230),a=n.n(r);e.a=a()({SET_METAMASK:null,SET_USER_AUTHENTICATION:null})},555:function(t,e,n){},557:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n.n(r),u=n(8),c=n(29),o=n(30),i=n(76),s=n(75),f=n(0),l=n.n(f),p=n(73),d=n.n(p),h=n(135),m=n(136),v=n(130),b=n(224),k=n(225),w=n.n(k),g=n(226),y=n.n(g),O=n(227),E=n.n(O),S=n(228),j=n.n(S),x={fallbackLng:"en",whitelist:["en","jp","cn"],ns:["translations"],defaultNS:"translations",keySeparator:!1,interpolation:{escapeValue:!1,formatSeparator:","},react:{wait:!0},resources:{en:w.a,jp:y.a,cn:E.a,vn:j.a}},T=n(20),A=n(44),M=n(34),N=n(96),P=n.n(N),I=function(){return l.a.createElement("div",null)},C=[{path:"/",name:"Home",component:P()({loader:function(){return Promise.all([n.e(0),n.e(7),n.e(5)]).then(n.bind(null,828))},loading:I})},{path:"/receive-link",exact:!0,name:"ReceiveLink",component:P()({loader:function(){return Promise.all([n.e(0),n.e(4),n.e(6)]).then(n.bind(null,826))},loading:I})},{path:"*",name:"404",component:P()({loader:function(){return n.e(8).then(n.bind(null,822))},loading:I})}],R=(n(131),n(333),n(23)),U=(n(555),function(t){Object(i.a)(n,t);var e=Object(s.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return l.a.createElement(M.c,null,C.map((function(t,e){return t.component?l.a.createElement(M.a,{key:e,path:t.path,exact:t.exact,name:t.name,render:function(e){return l.a.createElement(t.component,e)}}):null})))}}]),n}(l.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=n(13),_=n(35),D=n(69),H=n(70),L=n(71);n(556);n.d(e,"default",(function(){return W}));var W=function(t){Object(i.a)(n,t);var e=Object(s.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=Object(u.a)(a.a.mark((function t(){var e,n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[{key:B.a.USER_AUTHENTICATION,action:_.b,init:D.a.userAuth}],n=e.map(function(){var t=Object(u.a)(a.a.mark((function t(e){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(H.a)(T.a,e.key,e.action,e.init);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=4,Promise.all(n);case 4:setTimeout((function(){L.a.refreshMetaMask()}),500),R.b&&(R.b.currentProvider.on("accountsChanged",(function(t){console.log("accountsChanged"),L.a.refreshMetaMask()})),R.b.currentProvider.on("networkChanged",(function(t){L.a.refreshMetaMask()})),R.b.currentProvider.on("chainChanged",(function(t){L.a.refreshMetaMask()})));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return l.a.createElement(h.a,{store:T.a},l.a.createElement(A.a,null,l.a.createElement(M.c,null,l.a.createElement(M.a,{path:"/",name:"Home",component:U}))))}}]),n}(l.a.PureComponent);d.a.render(l.a.createElement(m.a,{i18n:(v.a.use(b.a).init(x),v.a)},l.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},69:function(t,e,n){"use strict";e.a={metamask:{},userAuth:{}}},70:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return u}));var r=n(49);function a(t,e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments.length>1?arguments[1]:void 0;return e.hasOwnProperty(r.type)?e[r.type](n,r):n}}var u=function(t,e,n,a){return new Promise((function(u,c){try{var o=Object(r.b)(e);o&&o!==a&&t.dispatch(n(o)),u()}catch(i){return u()}}))}},71:function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var r=n(1),a=n.n(r),u=n(8),c=n(29),o=n(30),i=n(23),s=n(129),f=n.n(s),l=n(13),p=n(20),d=n(35),h=n(149),m=h.tomoWeb3||h.web3,v=p.a.getState();p.a.subscribe((function(){v=p.a.getState()}));var b=function(){function t(){Object(c.a)(this,t)}return Object(o.a)(t,null,[{key:"refreshMetaMask",value:function(){var t=Object(u.a)(a.a.mark((function t(){var e,n,r,u,c,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(){return new Promise((function(t,e){var n=v.metamask,r=Object.assign({},n);try{if("undefined"===typeof m)r.status=l.b.NOWEB3,r.network=0,delete r.account,t(r);else{var a=new Promise((function(t,e){try{m.version.getNetwork((function(n,r){return n?e(n):t(r)}))}catch(n){return e(n)}})),u=new Promise((function(t,e){setTimeout((function(){return e("request timeout")}),3e3)}));Promise.race([a,u]).then((function(e){var n=parseInt(e),a=l.c.find((function(t){return t.key===n})),u=a?a.key:"Unknown";m.eth.getAccounts((function(e,n){e?(r.status=l.b.ERROR,r.network=u,delete r.account,t(r)):n&&n.length>0?(r.status=l.b.READY,r.network=u,r.account=n[0].toLowerCase(),t(r)):(r.status=l.b.LOADING,r.network=0,delete r.account,t(r))}))})).catch((function(e){r.status=l.b.LOCKED,r.network=0,delete r.account,t(r)}))}}catch(c){r.status=l.b.ERROR,r.network=0,delete r.account,t(r)}}))},r=(n=v).userAuth,u=n.metamask,t.next=4,e();case 4:c=t.sent,o=this.checkIsSigned(r,c),((c&&c.status)!==u.status||(c&&c.isSigned)!==o||c&&c.account!==u.account)&&(c.isSigned=o,p.a.dispatch(d.a(c)),(c.status===l.b.LOADING||c.account&&r.address&&c.account!==r.address)&&this.resetUser());case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"checkIsSigned",value:function(t,e){return!!(t&&t.address&&t.address.length>0&&e)&&e.account===t.address.toLowerCase()}},{key:"loginMetamask",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(){var c=Object(u.a)(a.a.mark((function c(o,s){var h,m,b,k;return a.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(){var e=Object(u.a)(a.a.mark((function e(u,c){var o,s,l,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(o=v.metamask)||!o.account){e.next=21;break}return"Sign Message",e.next=6,i.a.onSignMessage(o.account,"Sign Message".data?"Sign Message".data:"");case 6:if(!((s=e.sent)&&s.address&&s.signature)){e.next=17;break}return l=Object.assign({},{address:s.address,signature:s.signature+"|"+s.address}),p.a.dispatch(d.b(l)),(h=Object.assign({},o)).isSigned=!0,p.a.dispatch(d.a(h)),t&&t(),e.abrupt("return",u(null));case 17:return f.a.fire({width:"300px",text:n("metamask.youNeedSignMessage"),icon:"warning",showConfirmButton:!1}),p.a.dispatch(d.b({})),r&&r(),e.abrupt("return",u());case 21:return e.abrupt("return",u());case 24:e.prev=24,e.t0=e.catch(0),c(e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(t,n){return e.apply(this,arguments)}}())},b=(m=v).metamask,k=m.userAuth,c.prev=2,b.status!==l.c.NOWEB3){c.next=6;break}return f.a.fire({width:"300px",text:n("metamask.pleaseInstallFirst"),icon:"info",showConfirmButton:!1}),c.abrupt("return",o(null));case 6:if(!(b.account&&b.account.length>0)){c.next=16;break}if(t.checkIsSigned(k,b)){c.next=12;break}h(e),c.next=14;break;case 12:return e&&e(),c.abrupt("return",o(null));case 14:c.next=21;break;case 16:return c.next=18,i.a.enableMetaMask();case 18:return c.sent.length>0&&h(e),c.abrupt("return",o(null));case 21:c.next=26;break;case 23:return c.prev=23,c.t0=c.catch(2),c.abrupt("return",o(c.t0));case 26:case"end":return c.stop()}}),c,null,[[2,23]])})));return function(t,e){return c.apply(this,arguments)}}())}},{key:"resetUser",value:function(){return new Promise(function(){var t=Object(u.a)(a.a.mark((function t(e,n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{p.a.dispatch(d.b({})),e()}catch(n){e(n)}case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}]),t}()}},[[239,2,3]]]);
//# sourceMappingURL=main.6f3804e4.chunk.js.map